[toc]

# 数据链路层的基本概念

## 术语

链路：一条无源的点到点的物理线路段，中间没有任何其他的交换节点

数据链路：除了物理线路外，还必须有通信协议来控制这些数据的传输。若把实现这些协议的硬件和软件加到链路上，就构成了数据链路

帧：在数据链路层之间传输的数据单位是帧。

## 数据链路层的主要功能

向网络层提供**可靠的、透明的**数据传输服务，将源节点的网络层数据可靠地传送到相邻节点的网络层

- 链路管理

  数据链路的建立、维持和释放：两结点通信前要交换一些信息，称为建立数据连接，然后传输数据

- 封装成帧

  数据链路层，数据的传送以帧为单位：界定帧（帧同步）是指接收方能从收到的比特流中区分一个帧的开始和结束的地方

- 流量控制

  发送方发送数据的速率必须使接收方能来得及接收

- 差错控制

  纠错：通过编码技术，接收方自动将差错改正过来

  纠错：检测出帧有错误，要么忽略或重传

- 将数据和控制信息区分开

  数据和控制信息在同一个帧中，收方将其区分开

- 透明传输

  不管所传数据的比特组合，都能在链路上传送；

  若所传的数据的比特片段与某一个控制信息相同，要有可靠机制，保证收方能正确识别

- 寻址

  每一帧都能送到正确的目的地；

  收方也能知道发送方的地址

# 组帧

组帧（framing）就是在一段数据的前后分别添加首部和尾部，这样就构成了一个帧。

目的：让接收方能够准确识别帧的边界

首部和尾部的一个重要作用就是进行帧定界

## 帧定界（帧同步）的方法

### 字节计数法

#### 思想

在帧头设置一个长度域，放置该帧的字节数；收方收到帧后，通过帧的长度，确定帧的开始。

#### 问题

当帧长度域出错，帧同步完全丢失；该方法很少单独使用

### 使用字符填充的首尾定界法

#### 思想

使用特殊的ASCII字符（不可打印的控制字符）作为帧的起始和终止定界符。例如SOH作为开始符，EOT作为结束符。

#### 问题：数据传输不透明

当数据出现定界符SOH或EOT时，如何加以区分时数据还是定界符？

#### 解决

发送端的数据链路层在数据中出现控制字符的前面加一个转义符。接收端的数据链路层在将数据送往网络层之前删除插入的转义字符。

缺点：使用字符来控制帧的传输，数据传输的单位是字符（8bit的ASCII），帧长度时8的倍数；传输任意长度的二进制比特带来不便；

### 使用比特填充的首尾定界法*

#### 思想

使用一个特殊的比特模式01111110作为帧的起始和结束标志。

发送方：边发送边检查数据，没连续发送5个1后在后面自动插入一个0，这样数据中只会连续出现5个1而不会有定界符。

接收方：再收到5个连续的1后将后面的0删掉而会恢复出原始数据。

#### 好处

数据传输的基本单位是比特而不是字符，可用来传输任意长度的二进制比特串，通用性强。

### 违法编码法

#### 前提

物理介质上使用的信号编码有冗余码字时，使用这些荣荣誉的码字作为帧的定界。

#### 举例

如曼彻斯特编码或差分曼彻斯特编码中，有效电平是“低-高”或“高-低”，而“低-低”和“高-高”没有定义，这种违法编码可以作为帧边界。

# 差错控制

## 差错控制技术

### 前向纠错FEC

- 即发送方发送能使接收方检错并纠错的冗余位，纠错任务由接收方完成；常采用海明码。
- 主要应用于没有反向信道或反向传输时间很长的场合

#### 缺点

为纠错附加的冗余码较多，传输效率低

#### 优点

实时性好

### 自动重发请求ARQ

即发送方发送能使接收方**检错**的冗余位，若无差错，则接收方回送一个肯定应答ACK；若有差错，则接收方回送一个否定应答NAK，要求发送方重发。

#### 缺点

信息传递连贯性差

#### 优点

接收端设备简单，只要请求重发，无需纠正错误。

## 差错编码技术

### 差错编码

数据块中插入冗余信息的过程。

思想：判断一个数据块中是否存在传输错误，发送端必须在数据块中插入一些冗余信息，使得数据块中的各个比特建立某种形式的关联，接收端通过验证这种关联关系来判断是否有传输错误。

#### 策略

检错码：能检测出错误，但不能纠正错误，如CRC

纠错码：能知道错误，且知道错误的位置，如海明码

### 检错码（奇偶校验，CRC）

#### 构造

- 检错码（码字、传输帧）=信息位+冗余校验位
- 码字长：n=K（信息位位数）+r（校验位位数）
- 编码效率：R=有效数据位K/码字长n

#### 信息字段和校验字段之间的对应关系

- 校验字段越长，编码的检错能力越强，编码/解码越复杂；附加的冗余信息在整个编码中所占的比例越大，传输的有效成分越低，传输的效率下降。
- 检错码一旦形成，整个检错码将作为一个整体被发往线路，通常的发送顺序使信息字段在前，校验字段在后。

#### 奇偶校验

奇校验：使码字中“1”的总个数为奇数，包括信息位和校验位

偶校验：使码字中“1”的总个数为偶数

奇/偶校验码：最常用的一种检错码，包括

- 水平奇/偶校验码

  其信息字段以字符为单位，校验字段仅含一个比特称为校验比特或校验位。

  例如：使用七单位的ASCII码来构造成八单位的检错码时若采用奇偶校验，校验位的取值应使整个码字包括校验位，1的比特个数为奇数或偶数

  编码效率：Q/(Q+1)

  应用：异步传输用偶校验，同步传输用奇校验

- 垂直奇/偶校验码

  对信息按行、列分组，然后对列进行奇偶校验

  被传输的信息进行分组，并排列为若干行和若干列。组中每行的相同列进行奇/偶校验，最终产生由校验位形成的校验字符（校验行），并附加在信息分组之后传输

  举例：四个ASCII字符（四行）组成一信息组，求垂直奇偶校验码，存在最后一行

  编码效率：PQ/P(Q+1)假设信息分组Q行P列

- 水平垂直奇/偶校验码

  水平校验的基础上进行垂直校验，就是每一行后面都有一个奇偶校验位

  编码效率：PQ/(P+1)(Q+1)假设信息分组为Q行P列

#### 循环冗余码CRC

计算机和数据通信中使用的最广泛的检错码，漏检率低，可用简单的电路实现。

给定一个k比特的帧或比特，发送方生成n比特的序列（也称帧检测序列FCS），形成（k+n）的码字，该码字能被某个事先确定的数整除。接收方用相同的数去除收到的帧，如果无玉树，则认为数据帧无差错。

任意一个由二进制位串组成的代码都可以和一个系数仅为'0'和'1'取值的多项式一一对应。

多项式表示：即将k比特的数据用k项对象是表示，它的各项为X^(k-1)^...x^0^，它的系数为数据中对应位的0或1.

例如：1010111对应x^6^+x^4^+x^2^+x+1

多项式位x^5^+x^3^+x^2^+x+1对应101111

##### CRC计算

假设待传数据为1010001101 k bit。我们在M的后面再添加供差错检测用的n bit冗余码一起发送。

计算方法：

用二进制的模2运算进行2^n^乘m的运算，这相当于再M后面添加n个0.

得到的(k+n)bit的数除以事先选定好的长度为(n+1)bit的数P，得出商是Q而余数是R，余数R比除数P少1个比特。

核心问题：P如何选定？P若选定则n就确定了。

### 纠错码（海明）



# 点对点协议PPP



# 使用广播信道的数据链路层



# 以太网的MAC层



# 扩展的以太网



# 虚拟局域网

