[toc]
# 数据类型和文件格式
Hive对于数据在文件中的编码方式有非常大的灵活性，大多数数据库对数据有完全的控制，这种控制既包括对数据存储到磁盘的过程的控制，也包括对数据生命周期的控制。Hive将这些控制权转交给用户。

## 基本数据类型

|数据类型|长度|
|:-|:-|
|TINYINT|1字节有符号整数|
|SMALLINT|2字节有符号整数|
|INT|4字节有符号整数|
|BIGINT|8字节有符号整数|
|BOOLEAN|布尔类型,true或false|
|FLOAT|单精度浮点数|
|DOUBLE|双精度浮点|
|STRING|字符序列，可以指定字符集。可以单引号或双引号|
|TIMESTAMP|整数(UNIX新纪元时间)，浮点数(精确到小数点后后9位)，或者字符串(JDBC兼容的java.sql.Timestamp)|
|BINARY|字节数组|

以上都是保留字，所有数据类型都是对Java中的接口实现的，所以和Java中对应的行为完全一致。

BINARY数据类型和很多关系型数据库中的VARBINARY数据类型类似，但和BLOB并不相同。因为BINARY的列是存储在记录中的，而BLOB不同。BINARY可以在记录中包含任意字节，这样可以防止Hive尝试将其作为数字，字符串等进行解析。

> 用户不需要使用BINARY记录来省略每行记录的尾部，因为Hive会自动实现。比如一个表的结构位3列，而数据文件每行记录有5个字段，那么最后两列的数据会被省略。

## 集合数据类型
Hive的列支持使用struct，map和array集合数据类型。表中的语法实例实际调用的是内置函数。
|数据类型|描述|字面语法实例|
|:-|:-|:-|
|STRUCT|和C语言中的struct类似，可以通过`.`来访问元素内容，如果某个列的数据类型是STRUCT{first STRING, last STRING},那么第一个元素可以通过`字段名.first`来引用|struct('John','Doe')|
|MAP|MAP是一组键值对元组集合，使用数据表示法可以访问元素。例如，如果某个列的数据是MAP其中键值对是'first'->'John'和'last'->'Doe'，那么可以通过字段名['last']获得最后一个元素。|map('first','JOHN','last','Doe')|
|ARRAY|数组是一组具有相同类型和名称的变量的集合。这些变量称为数组的元素，每个数组元素都有一个编号，从0开始。数组值位['John','Doe']，那么第二个元素可以通过`数组名[1]`引用|Array('John','Doe')|

大多数关系型数据库不支持这些几何数据类型，因为使用它们会破坏标准格式，这会带来**增大数据冗余**的风险，进而导致消耗不必要的磁盘空间，还有可能造成数据不一致，因为当数据发生改变时冗余的拷贝数据可能无法进行相应的同步。

但是在大数据系统中，不遵循标准格式的好处是可以**提供更高吞吐量的数据**。当处理的数据的数量级是T或者P时，以最少的“头部寻址”来从磁盘上扫描数据是非常必要的。按数据集进行封装的话可以减少寻址次数来提高查询速度。根据外键关系关联则需要进行磁盘间的寻址，有很高的性能消耗。

> Hive没有键的概念，但是可以对表建立索引

### 样例
这里我们虚构一个员工表如下
```sql
CREATE TABLE employees(
    name STRING,
    salary FLOAT,
    subordinates ARRAY<STRING>,
    deductions MAP<STRING,FLOAT>,
    address STRUCT<street:STRING, city:STRING, state:STRING, zip:INT>
);
```
subordinates列表是一个字符串值数组。在该数组中，我们可以认为name是“主键”，因此subordinates中的每一个元素都将会引用这张表中的另一条记录。对于没有下属的员工，这个字段对应的就是空数组。在传统模型中，将会以另一种方式来表示这种关系，就是雇员和雇员经理的对应关系。

请注意后面是如何使用 Java 语法惯例来表示集合数据类型的。例如，`MAP<STRING，FLOAT>`表示 map 中的每个键都是 STRING 数据类型的，而每个值都是FLOAT数据类型的。对于`ARRAY<STRING>`，其中的每个条目都是STRING类型的。STRUCT可以混合多种不同的数据类型，但是**STRUCT中一旦声明好结构，那么其位置就不可以再改变。**

## 文本文件编码
|分隔符|描述|
|:-|:-|
|\n|对于文本文件来说，每行都是一条记录，因此换行符可以分割记录|
|Ctrl+A|用于分隔字段（列）。在CREATE TABLE语句中可以使用八进制编码\001 表示|
|Ctrl+B|用于分隔ARRARY或者STRUCT中的元素，或用于MAP中键值对之间的分隔。在CREATE TABLE语句中可以使用八进制编码\002表示|
|Ctrl+C|用于 MAP中键和值之间的分隔。在 CREATE TABLE 语句中可以使用八进制编码\003表示|

> 这些规则只会影响到Hive在读取文件后将如何进行划分。只有在一些比较极端的情况下，才需要用户手工去将数据按正确的格式写入文件。

### 样例
如下表结构声明定义的是一个表数据按照逗号进行分割的表。
```sql
CREATE TABLE some_data(
    first FLOAT,
    second FLOAT,
    third FLOAT
)
ROW FORMAT DELIMITED
FIELDS TERMINATED BY ',';
```
> 本例并没有合理地处理 CSV格式（值是逗号分隔的）和TSV格式（值是制表键分隔的）文件通常使用的场景。CSV和TSV格式的文件中文件头中包含有列名，而列值字符串也有可能是包含在引号中的，而且其列值中也有可能包含有返号或者制表键。

## 读时模式
当用户向传统数据库中写入数据时，不管采用装载外部数据还是查询一个