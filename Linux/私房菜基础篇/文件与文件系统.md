[toc]

# 文件

## 文件属性

使用```ls -h```命令可以看到以下文件属性

```bash
-rw-r--r--. 1 root root 4k May 4 18:01 *.cfg
```

- 第一栏代表文件类型和权限

  - 第一个字符代表文件类型
    - [-]文件
      - 纯文本(ASCII)
      - 二进制(binary)
      - 数据(data)
    - [d]目录
    - [l]链接文件
    - 设备与设备文件
      - [b]设备文件里面可供存储的周边设备（可按块读取）
      - [c]设备文件里的串行端口设备，例如键盘鼠标
    - [s]数据接口文件(sockets)
    - [p]数据传输文件(pipe,FIFO)
  - 接下来的字符三个一组，分别代表用户，用户组和其他人的权限
    - r读权限
    - w写权限
    - x执行权限（对目录来说是访问权限）

- 第二栏表示有多少文件链接到此节点（inode）

  每个文件都会将它的权限和属性记录到文件系统inode中，不过我们使用的目录树确实用文件名来记录，因此每个文件名就会链接到一个inode，这个属性记录的

- 第三栏是文件拥有者（owner）

- 第四栏是所属用户组（group）

- 第五栏是文件大小

- 第六栏是文件最后修改日期

- 第七栏是文件名

### 修改权限

- chgrp：修改用户组

  ```bash
  chgrp [-R] dirname/filename # -R递归修改
  ```

- chown：修改拥有者

  ```bash
  chown [-R] 账号名称 文件/目录
  chown [-R] 账号名称:用户组名称 文件/目录
  ```

- chmod：修改文件权限SUID，SGID，SBIT等属性

  ```bash
  r:4
  w:2
  x:1
  owner = rwx = 4+2+1 = 7
  group = r-x = 4+1 = 5
  other = r-- = 4
  chmod [-R] [权限数字] 文件/目录
  ```

## 目录与文件的权限意义

| 组件 | 内容         | 替代对象   | r          | w            | x            |
| ---- | ------------ | ---------- | ---------- | ------------ | ------------ |
| 文件 | 详细数据data | 文件夹     | 读文件内容 | 修改文件内容 | 执行文件内容 |
| 目录 | 文件名       | 可分类抽屉 | 读文件名   | 修改文件名   | 进入该目录   |

### 操作需要的权限

有目录

- /dir1/file1
- /dir2

| 操作             | /dir1 | /dir1/file1 | /dir2 | 重点                                  |
| ---------------- | ----- | ----------- | ----- | ------------------------------------- |
| 读取file1内容    | x     | r           | -     | 要能够进入/dir1才能读到里面的文件数据 |
| 修改file1内容    | x     | rw          | -     | 能进入/dir1并且读写file1              |
| 执行file1内容    | x     | rx          | -     | 能够进入/dir1且file1能运行            |
| 删除file1文件    | wx    | -           | -     | 能够进入/dir1且能修改目录             |
| file1复制到file2 | x     | r           | wx    | 能读取file1且能够修改dir2内容         |

# Linux目录配置

**FHS**（Filesystem Hierarchy Standard）希望用户了解到已安装软件通常放在哪个目录下。FHS依据文件系统使用的频繁与否与是否允许用户随意修改，而将目录定义成为四种交互作用的形态，用表格来讲如下：

| 可变性             | 可分享（shareable）                         | 不可分享（unshareable）  |
| ------------------ | ------------------------------------------- | ------------------------ |
| 不变（static）     | /usr （unix software resource, 软件存放处） | /etc （配置文件）        |
|                    | /opt （第三方辅助软件）                     | /boot （启动与内核文件） |
| 可变动（variable） | /var/mail （用户邮箱）                      | /var/run （程序相关）    |
|                    | /var/spool/news （新闻组）                  | /var/lock （程序相关）   |

## 四种类型

- 可分享：可以分享给其他系统挂载使用的目录，包括执行文件与用户邮箱等数据，是能够分享给网络上其他主机挂在用的目录；
- 不可分享：自己机器运行的设备文件或是程序有关的socket文件等，仅与机器有关，不适合分享给其他主机；
- 不变：这些数据不经常变动，跟随发行版。如函数库，文件说明，系统管理员所管理的主机服务配置文件等；
- 可变动：经常修改的数据，如日志文件，一般用户可以自行接收的新闻组等。

FHS针对目录树架构仅定义出三层目录下面应该放置什么数据

- /（root，根目录）：与启动系统有关；
- /usr （unix software resource）：软件安装，执行有关；
- /var （variable）：与系统运行过程有关；

## 根目录与内容

分为两部分：

- FHS必须要存在的目录
- FHS建议可已存在的目录

### 必须要存在的目录

| 目录   | 放置的内容                                                   |
| ------ | ------------------------------------------------------------ |
| /bin   | 放置在单人维护模式下还能使用的命令                           |
| /boot  | 启动会用到的文件，包括linux内核文件及启动选项与启动所需的配置文件等。 |
| /dev   | 设备与接口已文件形式存在于这个目录，只要读写下面的文件，相当于读写某个设备 |
| /etc   | 系统主要的配置文件都在这里，FHS建议**不要放置可执行文件**在这个目录。有几个文件最好要放在/etc/目录下，有：opt(必要，第三方辅助软件的配置文件)，x11(建议，与X Window有关的配置文件)，sgml(建议，与SGML格式有关的各项配置)，xml（与XML格式有关的各项配置文件） |
| /lib   | 系统库函数，一般方式启动时用到的库函数，以及在/bin和/sbin下命令用到的函数库。以下目录必须存在：/lib/modules/：内核相关模块（驱动程序） |
| /media | 媒体，放置可删除设备包括：软盘，光盘，DVD等                  |
| /mnt   | 暂时挂载某些额外设备，可以放置在此目录。                     |
| /opt   | 给第三方辅助软件，例如非原本发行版提供的独立软件。也习惯安装到/usr/local下 |
| /run   | 启动后产生的各项信息放置到/run下，可以用内存模拟             |
| /sbin  | 启动过程所需要的，包括了启动，修复，还原系统所需要的命令。某些服务器软件放置到/usr/sbin中，本机自行安装的软件产生系统执行文件放置到/usr/local/sbin/当中。常见包括：fdisk，fsck，ifconfig，mkfs |
| /srv   | service的缩写，是一些网络服务启动后，这些服务所需要使用的数据目录。如果尚未提供给因特网上浏览，那么可以放到/var/lib下 |
| /tmp   | 让一般用户或正在执行的程序暂时放置文件的地方                 |
| /usr   |                                                              |
| /var   |                                                              |

### 建议可以存在的目录

| 目录       | 放置的内容                                                   |
| ---------- | ------------------------------------------------------------ |
| /home      | 系统默认的用户家                                             |
| /lib<qual> | 用来存放与/lib不同格式的二进制函数库，例如支持64位的/lib64函数库等 |
| /root      | 系统管理员(root)的家目录，之所以放在这里，是因为如果进入单人维护模式而仅挂载根目录时，该目录就能拥有root家目录，所以我们会希望root的家目录和根目录在同一个分区 |

## Linux当中的重要目录

| 目录        | 放置的内容                                                   |
| ----------- | ------------------------------------------------------------ |
| /lost+found | 使用标注的ext2，ext3，ext4文件系统格式产生的目录，当文件系统发生错误时会将遗失片段存放到这里，如果使用xfs文件系统，则没有该目录 |
| /proc       | 这个目录本身是一个虚拟文件系统，放置的数据都是在内存当中，例如系统内核，进程信息，外接设备的状态以及网络等。因为这个目录下的数据都是在内存当中，例如系统内核，进程信息（process），外接设备的状态及网络状态等。因为这个目录下的数据都是在内存当中，所以本身不占任何硬盘空间。比较重要的文件例如：/proc/cpuinfo, /proc/dma, /proc/interrupts, /proc/ioports, /proc/net/* 等 |
| /sys        | 这个目录和proc非常相似，也是一个虚拟文件系统，主要记录内核与系统硬件相关信息。包括目前已经加载的内核模块和与内核检测到的硬件设备信息等，同样不占硬盘空间。 |

## /usr的意义与内容

根据FHS基本定义，/usr内容属于可分享与不可变动。存放的是操作系统软件资源，FHS建议所有软件开发者将数据合理地分别存放到这个目录下的子目录，不要自行建立软件独立目录。所有系统默认软件都会放置到/usr下。

### 必须存在的目录

| 目录       | 放置的内容                                                   |
| ---------- | ------------------------------------------------------------ |
| /usr/bin   | 所有一般用户可以使用的命令都放在这里，该目录下不应该有子目录 |
| /usr/lib   | 和lib功能相同                                                |
| /usr/local | 系统管理员在本机安装自己下载的软件                           |
| /usr/sbin  | 非系统正常运行所需要的系统命令，最常见的就是某些网络服务器软件的服务命令 |
| /usr/share | 存放只读的数据文件，包括共享文件，几乎是部分硬件架构均可读取的数据，常见有man，doc和zoneinfo（时区） |

### 建议存在的目录

| 目录           | 放置的内容                                                   |
| -------------- | ------------------------------------------------------------ |
| /usr/games/    | 与游戏比较相关的数据放置                                     |
| /usr/include/  | c/c++头文件与包含文件，以tarball方式安装时会用到其中文件     |
| /usr/libexec   | 不被一般用户常用的执行文件或脚本，例如大部分X Window下的命令 |
| /usr/lib<qual> | 和lib<qual>一致                                              |
| /usr/src/      | 一般源代码建议放置在这里，内核源代码在/usr/src/Linux/下      |

## /var的内容与意义

var目录主要针对经常性变动的文件，包括缓存(cache)，日志文件(log file)，以及某些软件运行所产生的文件，包括程序文件(lock file，run file)，例如Mysql数据库的文件等。

| 目录        | 放置的内容                                                   |
| ----------- | ------------------------------------------------------------ |
| /var/cache  | 程序运行产生的缓存                                           |
| /var/lib    | 程序执行过程中，需要使用到的数据文件放置的目录。此目录下各个软件应该有自己的目录。 |
| /var/lock   | 某些设备或是文件资源一次只能被一个应用程序所使用，如果同时有两个程序使用该设备时，就可能产生错误的状况，所以要将该设备上锁（lock）确保该设备只会给单一软件所使用。 |
| /var/log    | 日志文件，重要的文件有message和wtmp（记录登录信息）          |
| /var/mail   | 个人电子邮箱的目录，也被放在/var/spool/mail/下               |
| /var/run/   | 某些服务启动后，会将他们的PID放置在这个目录下，与/run相同    |
| /var/spool/ | 存放队列数据，排队等待其他程序使用的数据，通常使用后会被删除。如果是计划任务数据(crontab)，就会被放置在/var/spool/cron/下 |

# 文件与目录的默认权限与隐藏权限

新增一个文件或目录时，默认的权限是什么？

## 默认权限：umask

```bash
umask
0002 #代表默认不可写
umask -S #文字形式展示
```

umask的数字代表要减掉的权限，2代表没有写权限。

文件创建的默认权限为:

```bash
-rw-rw-rw-
```

目录创建的默认权限为：

```bash
drwxrwxrwx
```

## 隐藏属性

## chattr（配置文件隐藏属性）

``` bash
chattr [+-=] [ASacdistu] 文件或目录名称
+ 增加某个参数
- 删除某个参数
= 直接设置参数，仅有后续参数
A 在存取时间不会被修改，避免I/O较慢的机器过度读写磁盘
S 文件修改时同步写入磁盘
a 文件只能增加数据不能修改数据（只有root可以设置）
c 自动将文件压缩，读取时解压缩
d dump程序被执行时，设置d将使该文件或目录不会被dump备份
i 文件不能被删除，改名，设置链接，无法写入和新增数据（只有root可以设置)
s 如果文件被删除，会完全从硬盘删除
u 如果被删除，还可以被恢复
xfs文件系统只支持AadiS
```

## lsattr（显示文件隐藏属性）

```bash
lsattr [-adR] 文件或目录
a 显示隐藏的属性
d 仅列出目录的属性而非目录内的文件名
R 连同目录数据一并列出
```

## SUID,SGID,SBIT

### Set UID

当s出现在文件拥有者的x权限上时，此时成为SUID的特殊权限

- 仅对二进制程序有效
- 执行者需要对该程序有x权限
- 本权限仅在执行程序过程中有效
- 执行者将具有该拥有者的权限

以passwd为例，一般用户具有x权限，当用户执行该程序时，用户暂时拥有root（拥有者）权限

仅可用在二进制程序上，不能够用在shell脚本上面，因为shell脚本只是将很多的二进制执行文件调用执行，所以SUID的权限部分还是看shell脚本调用进来的程序设置，而不是shell脚本本身。SUID对目录也是无效的。

### Set GID

当s出现在用户组的x时称为SGID

- 对二进制程序有效
- 程序执行者对程序而言需要具备x权限
- 执行者在执行过程中会获得该程序用户组的支持

当一个目录被设置SGID时，拥有如下功能：

- 用户对目录具有r与x，能够进入目录
- 用户在此目录下的有效用户组会变成该目录的用户组
- 用途：若用户在此目录下具有w权限，则用户新建立的文件，与新文件的用户组和此用户组相同

### Sticky Bit

SBIT只针对目录有效，对于文件没有效果，SBIT对目录的作用为：

- 当用户对目录有w,x权限时建立文件或目录，只有root或者自己才能删除

### 权限设置

``` bash
chmod *755 filename
4 SUID
2 SGID
1 SBIT
chmod u=rwxs,go=x filename
```



# 文件查找

- which查找执行文件
- whereis
- locate/updatedb
- find
